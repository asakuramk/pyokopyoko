<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„ÅäÂÆ∂„Å∏Â∏∞„Çç„ÅÜ v1.0</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            background: linear-gradient(to bottom, #FFB6C1 0%, #FFC0CB 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            touch-action: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }
        #root {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        .game-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        canvas {
            display: block;
            touch-action: none;
        }
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .message-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 50px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            pointer-events: auto;
            border: 5px solid #FFD93D;
            max-width: 90%;
        }
        .message-box h1 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 32px;
        }
        .message-box p {
            margin: 0 0 20px 0;
            color: #555;
            font-size: 16px;
            line-height: 1.6;
        }
        .version {
            font-size: 14px !important;
            color: #FF6B6B !important;
            font-weight: bold;
            margin-bottom: 5px !important;
        }
        .btn {
            background: #FF6B6B;
            color: white;
            border: none;
            padding: 15px 45px;
            font-size: 22px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 0 #D64545;
            transition: all 0.1s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #D64545;
        }
        .score {
            position: absolute;
            top: 15px;
            left: 15px;
            color: white;
            font-weight: bold;
            font-size: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.3);
            padding: 8px 20px;
            border-radius: 25px;
            pointer-events: none;
        }
        .controls-hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 14px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function Game() {
            const canvasRef = useRef(null);
            const [gameState, setGameState] = useState('start');
            const [score, setScore] = useState(0);
            const gameLoopRef = useRef(null);
            const gameDataRef = useRef({
                player: { x: 0, y: 0, vx: 0, vy: 0, width: 34, height: 34 },
                platforms: [],
                camera: { y: 0 },
                keys: { left: false, right: false },
                maxScore: 0
            });

            const GRAVITY = 0.4;
            const JUMP_FORCE = -11.5;
            const MOVE_SPEED = 5.5;
            const GOAL_HEIGHT = 6000;

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const resizeCanvas = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);

                return () => window.removeEventListener('resize', resizeCanvas);
            }, []);

            useEffect(() => {
                if (gameState !== 'playing') return;

                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');

                // „Ç≤„Éº„É†ÂàùÊúüÂåñ
                const initGame = () => {
                    const data = gameDataRef.current;
                    data.player.x = canvas.width / 2 - 17;
                    data.player.y = canvas.height - 150;
                    data.player.vx = 0;
                    data.player.vy = 0;
                    data.camera.y = 0;
                    data.maxScore = 0;

                    // Ë∂≥Â†¥ÁîüÊàê
                    data.platforms = [];
                    let prevX = canvas.width / 2 - 100;
                    data.platforms.push({
                        x: prevX, y: canvas.height - 50, w: 200, h: 20, type: 'normal'
                    });

                    let currentY = canvas.height - 50;
                    while (currentY > -GOAL_HEIGHT) {
                        const gap = 70 + Math.random() * 60;
                        currentY -= gap;

                        let w = 90 + Math.random() * 20;
                        let minX = Math.max(0, prevX - 280);
                        let maxX = Math.min(canvas.width - w, prevX + 280);
                        let x = minX + Math.random() * (maxX - minX);

                        data.platforms.push({
                            x: x, y: currentY, w: w, h: 20, type: 'normal'
                        });
                        prevX = x;
                    }

                    // „Ç¥„Éº„É´
                    data.platforms.push({
                        x: canvas.width / 2 - 150, y: -GOAL_HEIGHT,
                        w: 300, h: 20, type: 'goal'
                    });
                };

                initGame();

                // „Ç≤„Éº„É†„É´„Éº„Éó
                const gameLoop = () => {
                    const data = gameDataRef.current;
                    
                    // Êõ¥Êñ∞
                    if (data.keys.left) data.player.vx = -MOVE_SPEED;
                    else if (data.keys.right) data.player.vx = MOVE_SPEED;
                    else data.player.vx *= 0.8;

                    data.player.x += data.player.vx;
                    if (data.player.x + data.player.width < 0) data.player.x = canvas.width;
                    if (data.player.x > canvas.width) data.player.x = -data.player.width;

                    data.player.vy += GRAVITY;
                    data.player.y += data.player.vy;

                    // Ë°ùÁ™ÅÂà§ÂÆö
                    if (data.player.vy > 0) {
                        data.platforms.forEach(p => {
                            if (
                                data.player.x + data.player.width > p.x &&
                                data.player.x < p.x + p.w &&
                                data.player.y + data.player.height > p.y &&
                                data.player.y + data.player.height < p.y + p.h + 10
                            ) {
                                data.player.y = p.y - data.player.height;
                                data.player.vy = JUMP_FORCE;

                                if (p.type === 'goal') {
                                    setGameState('win');
                                }
                            }
                        });
                    }

                    // „Ç´„É°„É©
                    const targetCamY = data.player.y - canvas.height / 2;
                    if (targetCamY < data.camera.y) {
                        data.camera.y = targetCamY;
                    }

                    // „Çπ„Ç≥„Ç¢
                    const currentHeight = Math.floor((canvas.height - data.player.y) / 10);
                    if (currentHeight > data.maxScore) {
                        data.maxScore = currentHeight;
                        setScore(currentHeight);
                    }

                    // „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº
                    if (data.player.y > data.camera.y + canvas.height + 100) {
                        setGameState('gameover');
                    }

                    // ÊèèÁîª
                    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    grad.addColorStop(0, '#FFB6C1');
                    grad.addColorStop(1, '#FFC0CB');
                    ctx.fillStyle = grad;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // Ë∂≥Â†¥ÊèèÁîª
                    data.platforms.forEach(p => {
                        const screenY = p.y - data.camera.y;
                        if (screenY > -50 && screenY < canvas.height + 50) {
                            ctx.fillStyle = p.type === 'goal' ? '#FFD93D' : '#65B741';
                            ctx.fillRect(p.x, screenY, p.w, p.h);
                        }
                    });

                    // „Éó„É¨„Ç§„É§„ÉºÊèèÁîª
                    const playerScreenY = data.player.y - data.camera.y;
                    ctx.fillStyle = '#FFD93D';
                    ctx.fillRect(data.player.x, playerScreenY, data.player.width, data.player.height);
                    
                    // È°î
                    ctx.fillStyle = '#333';
                    const centerX = data.player.x + data.player.width / 2;
                    ctx.beginPath();
                    ctx.arc(centerX - 7, playerScreenY + 12, 3, 0, Math.PI * 2);
                    ctx.arc(centerX + 7, playerScreenY + 12, 3, 0, Math.PI * 2);
                    ctx.fill();

                    gameLoopRef.current = requestAnimationFrame(gameLoop);
                };

                gameLoop();

                return () => {
                    if (gameLoopRef.current) {
                        cancelAnimationFrame(gameLoopRef.current);
                    }
                };
            }, [gameState]);

            // „Çø„ÉÉ„ÉÅÊìç‰Ωú
            useEffect(() => {
                const handleTouchStart = (e) => {
                    if (gameState !== 'playing') return;
                    e.preventDefault();
                    const touchX = e.touches[0].clientX;
                    const data = gameDataRef.current;
                    if (touchX < window.innerWidth / 2) {
                        data.keys.left = true;
                        data.keys.right = false;
                    } else {
                        data.keys.right = true;
                        data.keys.left = false;
                    }
                };

                const handleTouchEnd = (e) => {
                    e.preventDefault();
                    const data = gameDataRef.current;
                    data.keys.left = false;
                    data.keys.right = false;
                };

                const handleKeyDown = (e) => {
                    const data = gameDataRef.current;
                    if (e.code === 'ArrowLeft') data.keys.left = true;
                    if (e.code === 'ArrowRight') data.keys.right = true;
                };

                const handleKeyUp = (e) => {
                    const data = gameDataRef.current;
                    if (e.code === 'ArrowLeft') data.keys.left = false;
                    if (e.code === 'ArrowRight') data.keys.right = false;
                };

                window.addEventListener('touchstart', handleTouchStart, { passive: false });
                window.addEventListener('touchend', handleTouchEnd, { passive: false });
                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('keyup', handleKeyUp);

                return () => {
                    window.removeEventListener('touchstart', handleTouchStart);
                    window.removeEventListener('touchend', handleTouchEnd);
                    window.removeEventListener('keydown', handleKeyDown);
                    window.removeEventListener('keyup', handleKeyUp);
                };
            }, [gameState]);

            const handleStart = () => {
                setScore(0);
                setGameState('playing');
            };

            const handleRetry = () => {
                setScore(0);
                setGameState('playing');
            };

            return (
                <div className="game-container">
                    <canvas ref={canvasRef} />
                    
                    {gameState === 'playing' && (
                        <>
                            <div className="score">È´ò„Åï: {score}m</div>
                            <div className="controls-hint">
                                PC: Áü¢Âç∞„Ç≠„Éº / „Çπ„Éû„Éõ: ÁîªÈù¢Â∑¶Âè≥„Çø„ÉÉ„Éó
                            </div>
                        </>
                    )}

                    <div className="ui-overlay">
                        {gameState === 'start' && (
                            <div className="message-box">
                                <h1>üè† „ÅäÂÆ∂„Å∏Â∏∞„Çç„ÅÜ</h1>
                                <p className="version">v1.0 ReactÁâà</p>
                                <p>„Ç∏„É£„É≥„Éó„Åó„Å¶6000m‰∏ä„ÅÆ„ÅäÂÆ∂„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ</p>
                                <button className="btn" onTouchStart={handleStart} onClick={handleStart}>
                                    „Çπ„Çø„Éº„ÉàÔºÅ
                                </button>
                            </div>
                        )}

                        {gameState === 'gameover' && (
                            <div className="message-box">
                                <h1 style={{color: '#FF6B6B'}}>ËêΩ„Å°„Å°„ÇÉ„Å£„Åü...</h1>
                                <p>Âà∞ÈÅîÈ´ò„Åï: {score}m</p>
                                <button className="btn" onTouchStart={handleRetry} onClick={handleRetry}>
                                    „ÇÇ„ÅÜ‰∏ÄÂõûÔºÅ
                                </button>
                            </div>
                        )}

                        {gameState === 'win' && (
                            <div className="message-box">
                                <h1 style={{color: '#4ECDC4'}}>üéâ „Åü„Å†„ÅÑ„Åæ„Å£ÔºÅ</h1>
                                <p>ÁÑ°‰∫ã„Å´„ÅäÂÆ∂„Å´Â∏∞„Çå„Åæ„Åó„ÅüÔºÅ</p>
                                <p>Âà∞ÈÅîÈ´ò„Åï: {score}m</p>
                                <button className="btn" onTouchStart={handleRetry} onClick={handleRetry}>
                                    „Åæ„ÅüÈÅä„Å∂
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Game />);
    </script>
</body>
</html>
